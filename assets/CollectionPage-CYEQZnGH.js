import{j as e}from"./md-editor-C1q9TcpX.js";import{r as d,h as R,u as T}from"./react-vendor-tRUzE08Q.js";import{c as P,T as $,M as A,C as W,X as B,P as E,d as M,I as G,s as K,g as O,e as V,S as X,h as Y,i as H,j as J}from"./index-BFU_njf7.js";import{E as Q}from"./external-link-cKziVxm1.js";import{C as U,S as Z}from"./ConfirmDialog-CjtMJDw2.js";import{C as ee}from"./chevron-down-B4Rhi2K0.js";import"./supabase-BZ0N5lZN.js";const te=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],se=P("check",te);const ae=[["path",{d:"M5 12h14",key:"1ays0h"}]],ne=P("minus",ae);function re({field:t,value:a}){if(a==null||a==="")return e.jsx("span",{className:"text-[#4a4660]",children:"—"});switch(t.field_type){case"text":return e.jsx("span",{className:"text-[#e0dfe4] truncate block max-w-[200px]",children:String(a)});case"number":{const n=t.options?.prefix??"",r=t.options?.suffix??"";return e.jsxs("span",{className:"text-[#e0dfe4]",children:[n,String(a),r]})}case"date":{const n=new Date(String(a)),r=isNaN(n.getTime())?String(a):n.toLocaleDateString([],{month:"short",day:"numeric",year:"numeric"});return e.jsx("span",{className:"text-[#e0dfe4]",children:r})}case"select":return e.jsx("span",{className:"inline-block px-2.5 py-0.5 rounded-full text-[12px] font-medium bg-[#ec4899]/15 text-[#ec4899] border border-[#ec4899]/20",children:String(a)});case"checkbox":return a?e.jsx(se,{size:16,className:"text-[#ec4899]"}):e.jsx(ne,{size:16,className:"text-[#4a4660]"});case"url":{const n=String(a);let r=n;try{r=new URL(n.startsWith("http")?n:`https://${n}`).hostname}catch{}return e.jsxs("a",{href:n.startsWith("http")?n:`https://${n}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-[#ec4899] hover:text-[#db2777] transition-colors text-[13px]",onClick:l=>l.stopPropagation(),children:[r,e.jsx(Q,{size:12})]})}default:return e.jsx("span",{className:"text-[#e0dfe4]",children:String(a)})}}function ie({fields:t,items:a,onItemClick:n,onDeleteItem:r}){return t.length===0?e.jsx("div",{className:"rounded-xl border border-[#1c1928] bg-[#0f0d18] py-16 text-center",children:e.jsx("p",{className:"text-[14px] text-[#7a7890]",children:"No fields defined yet. Open settings to add fields."})}):e.jsxs("div",{className:"rounded-xl border border-[#1c1928] overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-[#1c1928]",children:[t.map(l=>e.jsx("th",{className:"px-4 py-3 text-left text-[12px] font-medium text-[#7a7890] uppercase tracking-wider whitespace-nowrap bg-[#0f0d18]",children:l.name},l.id)),e.jsx("th",{className:"w-10 bg-[#0f0d18]"})]})}),e.jsx("tbody",{children:a.map(l=>e.jsxs("tr",{onClick:()=>n(l),className:"border-b border-[#1c1928] last:border-b-0 hover:bg-white/[0.02] cursor-pointer transition-colors group",children:[t.map(o=>e.jsx("td",{className:"px-4 py-3 text-[13px]",children:e.jsx(re,{field:o,value:l.data[o.id]})},o.id)),e.jsx("td",{className:"px-2 py-3",children:e.jsx("button",{onClick:o=>{o.stopPropagation(),r(l.id)},className:"opacity-0 group-hover:opacity-100 text-[#7a7890] hover:text-red-400 transition-all p-1",title:"Delete item",children:e.jsx($,{size:14})})})]},l.id))})]})}),a.length===0&&e.jsx("div",{className:"py-16 text-center",children:e.jsx("p",{className:"text-[14px] text-[#7a7890]",children:"No items yet. Add one to get started."})})]})}function oe({open:t,onClose:a,onSave:n,fields:r,item:l}){const[o,m]=d.useState({}),[h,p]=d.useState(!1);d.useEffect(()=>{t&&m(l?.data??{})},[t,l]);const g=(c,i)=>{m(b=>({...b,[c]:i}))},f=async c=>{c.preventDefault(),p(!0);try{await n(o),a()}finally{p(!1)}};return e.jsx(A,{open:t,onClose:a,children:e.jsxs("form",{onSubmit:f,className:"p-6",children:[e.jsx("h3",{className:"text-[15px] font-semibold text-white mb-5",children:l?"Edit Item":"Add Item"}),e.jsx("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto",children:r.map(c=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-[13px] text-[#b0adc0] mb-1.5",children:[c.name,c.is_required&&e.jsx("span",{className:"text-[#ec4899] ml-0.5",children:"*"})]}),e.jsx(le,{field:c,value:o[c.id],onChange:i=>g(c.id,i)})]},c.id))}),r.length===0&&e.jsx("p",{className:"text-[13px] text-[#7a7890] py-4",children:"No fields defined. Add fields in collection settings first."}),e.jsxs("div",{className:"flex justify-end gap-2.5 mt-6 pt-4 border-t border-[#1c1928]",children:[e.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 text-[13px] text-[#7a7890] hover:text-white rounded-lg hover:bg-white/[0.04] transition-all",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:h||r.length===0,className:"px-5 py-2 text-[13px] bg-[#ec4899] hover:bg-[#db2777] text-white font-medium rounded-full transition-colors disabled:opacity-50",children:h?"Saving...":"Save"})]})]})})}function le({field:t,value:a,onChange:n}){const r="w-full bg-transparent border border-[#1c1928] rounded-lg px-3 py-2 text-[13px] text-white placeholder-[#4a4660] outline-none focus:border-[#2d2a40] transition-colors";switch(t.field_type){case"text":return e.jsx("input",{type:"text",value:String(a??""),onChange:l=>n(l.target.value),placeholder:`Enter ${t.name.toLowerCase()}...`,required:t.is_required,className:r});case"number":return e.jsxs("div",{className:"flex items-center gap-2",children:[t.options?.prefix&&e.jsx("span",{className:"text-[13px] text-[#7a7890]",children:t.options.prefix}),e.jsx("input",{type:"number",value:a!=null?String(a):"",onChange:l=>n(l.target.value?Number(l.target.value):null),placeholder:"0",required:t.is_required,className:r,step:"any"}),t.options?.suffix&&e.jsx("span",{className:"text-[13px] text-[#7a7890]",children:t.options.suffix})]});case"date":return e.jsx("input",{type:"date",value:String(a??""),onChange:l=>n(l.target.value),required:t.is_required,className:`${r} [color-scheme:dark]`});case"select":{const l=t.options?.choices??[];return e.jsxs("select",{value:String(a??""),onChange:o=>n(o.target.value),required:t.is_required,className:`${r} bg-[#13111c]`,children:[e.jsx("option",{value:"",children:"Select..."}),l.map(o=>e.jsx("option",{value:o,children:o},o))]})}case"checkbox":return e.jsx("button",{type:"button",onClick:()=>n(!a),className:`w-9 h-9 rounded-lg border-2 flex items-center justify-center transition-all ${a?"border-[#ec4899] bg-[#ec4899]/20 text-[#ec4899]":"border-[#1c1928] text-[#4a4660] hover:border-[#2d2a40]"}`,children:a?"✓":""});case"url":return e.jsx("input",{type:"url",value:String(a??""),onChange:l=>n(l.target.value),placeholder:"https://...",required:t.is_required,className:r});default:return e.jsx("input",{type:"text",value:String(a??""),onChange:l=>n(l.target.value),className:r})}}const ce=[{value:"text",label:"Text"},{value:"number",label:"Number"},{value:"date",label:"Date"},{value:"select",label:"Select"},{value:"checkbox",label:"Checkbox"},{value:"url",label:"URL"}];function de({field:t,isFirst:a,isLast:n,onUpdate:r,onDelete:l,onMoveUp:o,onMoveDown:m}){const[h,p]=d.useState(""),g=t.options?.choices??[],f=()=>{const i=h.trim();!i||g.includes(i)||(r({options:{...t.options,choices:[...g,i]}}),p(""))},c=i=>{r({options:{...t.options,choices:g.filter(b=>b!==i)}})};return e.jsxs("div",{className:"flex flex-col gap-2 p-3 rounded-lg border border-[#1c1928] bg-[#0f0d18]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:t.name,onChange:i=>r({name:i.target.value}),placeholder:"Field name",className:"flex-1 bg-transparent border border-[#1c1928] rounded-lg px-3 py-1.5 text-[13px] text-white placeholder-[#4a4660] outline-none focus:border-[#2d2a40]"}),e.jsx("select",{value:t.field_type,onChange:i=>r({field_type:i.target.value}),className:"bg-[#13111c] border border-[#1c1928] rounded-lg px-2 py-1.5 text-[13px] text-[#e0dfe4] outline-none focus:border-[#2d2a40]",children:ce.map(i=>e.jsx("option",{value:i.value,children:i.label},i.value))}),e.jsx("button",{onClick:()=>r({is_required:!t.is_required}),title:t.is_required?"Required":"Optional",className:`px-2 py-1.5 rounded-lg text-[11px] font-medium border transition-colors ${t.is_required?"border-[#ec4899]/30 text-[#ec4899] bg-[#ec4899]/10":"border-[#1c1928] text-[#4a4660] hover:text-[#7a7890]"}`,children:"Req"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("button",{onClick:o,disabled:a,className:"text-[#7a7890] hover:text-white disabled:opacity-20 disabled:cursor-default transition-colors",children:e.jsx(W,{size:14})}),e.jsx("button",{onClick:m,disabled:n,className:"text-[#7a7890] hover:text-white disabled:opacity-20 disabled:cursor-default transition-colors",children:e.jsx(ee,{size:14})})]}),e.jsx("button",{onClick:l,className:"text-[#7a7890] hover:text-red-400 transition-colors",children:e.jsx($,{size:14})})]}),t.field_type==="number"&&e.jsxs("div",{className:"flex items-center gap-2 pl-1",children:[e.jsx("input",{type:"text",value:t.options?.prefix??"",onChange:i=>r({options:{...t.options,prefix:i.target.value}}),placeholder:"Prefix (e.g. $)",className:"w-24 bg-transparent border border-[#1c1928] rounded-lg px-2 py-1 text-[12px] text-white placeholder-[#4a4660] outline-none focus:border-[#2d2a40]"}),e.jsx("input",{type:"text",value:t.options?.suffix??"",onChange:i=>r({options:{...t.options,suffix:i.target.value}}),placeholder:"Suffix (e.g. /mo)",className:"w-28 bg-transparent border border-[#1c1928] rounded-lg px-2 py-1 text-[12px] text-white placeholder-[#4a4660] outline-none focus:border-[#2d2a40]"})]}),t.field_type==="select"&&e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 pl-1",children:[g.map(i=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[12px] bg-[#ec4899]/15 text-[#ec4899] border border-[#ec4899]/20",children:[i,e.jsx("button",{onClick:()=>c(i),className:"hover:text-white transition-colors",children:e.jsx(B,{size:10})})]},i)),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"text",value:h,onChange:i=>p(i.target.value),onKeyDown:i=>{i.key==="Enter"&&(i.preventDefault(),f())},placeholder:"Add choice...",className:"w-24 bg-transparent border border-[#1c1928] rounded-lg px-2 py-0.5 text-[12px] text-white placeholder-[#4a4660] outline-none focus:border-[#2d2a40]"}),e.jsx("button",{onClick:f,className:"text-[#7a7890] hover:text-[#ec4899] transition-colors",children:e.jsx(E,{size:12})})]})]})]})}function xe({open:t,onClose:a,collection:n,fields:r,onDeleted:l}){const{updateCollection:o,deleteCollection:m,createField:h,updateField:p,deleteField:g,refreshFields:f}=M(),[c,i]=d.useState(n.name),[b,w]=d.useState(n.icon),[N,v]=d.useState(!1),[S,y]=d.useState(!1),[C,k]=d.useState(!1),_=async()=>{if(c.trim()){k(!0);try{const s={};c!==n.name&&(s.name=c.trim(),s.slug=K(c.trim())),b!==n.icon&&(s.icon=b),Object.keys(s).length>0&&await o(n.id,s),a()}finally{k(!1)}}},D=async()=>{await m(n.id),l()},q=async()=>{await h(n.id,{name:"",field_type:"text",position:r.length})},z=async(s,x)=>{await p(s,x)},F=async s=>{await g(s,n.id)},I=async(s,x)=>{const u=x==="up"?s-1:s+1;if(u<0||u>=r.length)return;const j=r[s],L=r[u];await Promise.all([p(j.id,{position:L.position}),p(L.id,{position:j.position})]),await f(n.id)};return e.jsxs(e.Fragment,{children:[e.jsx(A,{open:t,onClose:a,children:e.jsxs("div",{className:"p-6 max-h-[80vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-[15px] font-semibold text-white mb-5",children:"Collection Settings"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-[13px] text-[#b0adc0] mb-1.5",children:"Name"}),e.jsx("input",{type:"text",value:c,onChange:s=>i(s.target.value),className:"w-full bg-transparent border border-[#1c1928] rounded-lg px-3 py-2 text-[13px] text-white placeholder-[#4a4660] outline-none focus:border-[#2d2a40] transition-colors"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-[13px] text-[#b0adc0] mb-1.5",children:"Icon"}),e.jsxs("button",{onClick:()=>v(!N),className:"flex items-center gap-2 px-3 py-2 border border-[#1c1928] rounded-lg text-[13px] text-[#e0dfe4] hover:border-[#2d2a40] transition-colors",children:[(()=>{const s=O(b);return e.jsx(s,{size:16})})(),e.jsx("span",{children:b})]}),N&&e.jsx("div",{className:"mt-2 border border-[#1c1928] rounded-lg bg-[#0f0d18]",children:e.jsx(G,{current:b,onChange:s=>{w(s),v(!1)}})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"text-[13px] text-[#b0adc0]",children:"Fields"}),e.jsxs("button",{onClick:q,className:"inline-flex items-center gap-1 text-[12px] text-[#7a7890] hover:text-[#ec4899] transition-colors",children:[e.jsx(E,{size:12}),"Add"]})]}),e.jsxs("div",{className:"space-y-2",children:[r.map((s,x)=>e.jsx(de,{field:s,isFirst:x===0,isLast:x===r.length-1,onUpdate:u=>z(s.id,u),onDelete:()=>F(s.id),onMoveUp:()=>I(x,"up"),onMoveDown:()=>I(x,"down")},s.id)),r.length===0&&e.jsx("p",{className:"text-[12px] text-[#4a4660] py-4 text-center",children:"No fields yet."})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-[#1c1928]",children:[e.jsx("button",{onClick:()=>y(!0),className:"text-[13px] text-red-400 hover:text-red-300 transition-colors",children:"Delete Collection"}),e.jsxs("div",{className:"flex gap-2.5",children:[e.jsx("button",{onClick:a,className:"px-4 py-2 text-[13px] text-[#7a7890] hover:text-white rounded-lg hover:bg-white/[0.04] transition-all",children:"Cancel"}),e.jsx("button",{onClick:_,disabled:C||!c.trim(),className:"px-5 py-2 text-[13px] bg-[#ec4899] hover:bg-[#db2777] text-white font-medium rounded-full transition-colors disabled:opacity-50",children:C?"Saving...":"Save"})]})]})]})}),e.jsx(U,{open:S,onClose:()=>y(!1),onConfirm:D,title:"Delete Collection",message:`Are you sure you want to delete "${n.name}"? All items in this collection will be permanently deleted.`})]})}function je(){const{slug:t}=R(),a=T(),{collections:n,fieldsByCollection:r,loading:l}=M(),o=n.find(s=>s.slug===t),m=o?r[o.id]??[]:[],[h,p]=d.useState([]),[g,f]=d.useState(!0),[c,i]=d.useState(""),[b,w]=d.useState(!1),[N,v]=d.useState(null),[S,y]=d.useState(!1),C=d.useCallback(async()=>{if(o){f(!0);try{const s=await V(o.id);p(s)}finally{f(!1)}}},[o]);d.useEffect(()=>{o?C():(p([]),f(!1))},[o,C]);const k=d.useMemo(()=>{if(!c)return h;const s=c.toLowerCase();return h.filter(x=>m.some(u=>{if(u.field_type==="checkbox")return!1;const j=x.data[u.id];return j!=null&&String(j).toLowerCase().includes(s)}))},[h,c,m]),_=async s=>{if(o)if(N){const x=await Y(N.id,{data:s});p(u=>u.map(j=>j.id===N.id?x:j))}else{const x=await H({collection_id:o.id,data:s});p(u=>[x,...u])}},D=async s=>{await J(s),p(x=>x.filter(u=>u.id!==s))},q=()=>{v(null),w(!0)},z=s=>{v(s),w(!0)},F=()=>{y(!1),a("/")};if(l)return e.jsx("div",{className:"text-[#7a7890] text-[14px] text-center pt-40",children:"Loading..."});if(!o)return e.jsxs("div",{className:"text-center pt-40",children:[e.jsx("p",{className:"text-[14px] text-[#7a7890]",children:"Collection not found."}),e.jsx("button",{onClick:()=>a("/"),className:"text-[#ec4899] text-[13px] mt-2 hover:underline",children:"Go home"})]});const I=O(o.icon);return e.jsxs("div",{className:"max-w-[1200px] px-12 py-10",children:[e.jsxs("div",{className:"mb-1 flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{size:24,className:"text-[#ec4899]"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-[26px] font-bold text-white leading-tight",children:o.name}),e.jsxs("p",{className:"text-[14px] text-[#7a7890] mt-1",children:[h.length," ",h.length===1?"item":"items"]})]})]}),e.jsx("button",{onClick:()=>y(!0),className:"p-2 text-[#7a7890] hover:text-white hover:bg-white/[0.04] rounded-lg transition-all",title:"Collection settings",children:e.jsx(X,{size:18})})]}),e.jsx("div",{className:"flex items-center justify-between mt-8 mb-8",children:e.jsxs("div",{className:"relative",children:[e.jsx(Z,{size:14,className:"absolute left-4 top-1/2 -translate-y-1/2 text-[#7a7890]"}),e.jsx("input",{type:"text",placeholder:`Search ${o.name.toLowerCase()}...`,value:c,onChange:s=>i(s.target.value),className:"pl-10 pr-5 py-2 bg-transparent border border-[#1c1928] rounded-full text-[13px] text-[#e0dfe4] placeholder-[#4a4660] outline-none focus:border-[#2d2a40] transition-colors w-72"})]})}),g?e.jsx("div",{className:"text-[#7a7890] text-[14px] text-center pt-20",children:"Loading items..."}):e.jsx(ie,{fields:m,items:k,onItemClick:z,onDeleteItem:D}),e.jsx(oe,{open:b,onClose:()=>{w(!1),v(null)},onSave:_,fields:m,item:N}),S&&e.jsx(xe,{open:S,onClose:()=>y(!1),collection:o,fields:m,onDeleted:F}),e.jsx("button",{onClick:q,className:"fixed bottom-8 right-8 w-14 h-14 rounded-full bg-[#ec4899] hover:bg-[#db2777] text-white shadow-lg shadow-[#ec4899]/25 hover:shadow-[#ec4899]/40 transition-all flex items-center justify-center z-30",title:"Add Item",children:e.jsx(E,{size:24,strokeWidth:2.5})})]})}export{je as default};
