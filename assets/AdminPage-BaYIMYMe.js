import{j as e}from"./md-editor-C1q9TcpX.js";import{r as o}from"./react-vendor-tRUzE08Q.js";import{c as d,k as R,l as q,m as E,U as b,n as F,o as I,p as O,f as k,T as G,q as K,r as V,v as X,w as Y,x as Z}from"./index-BFU_njf7.js";import{S as J,C as u}from"./ConfirmDialog-CjtMJDw2.js";import"./supabase-BZ0N5lZN.js";const Q=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],W=d("circle-check-big",Q);const ee=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],te=d("folder-open",ee);const se=[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]],ae=d("hard-drive",se);const ne=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],le=d("user-check",ne);const ie=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],oe=d("user-minus",ie);const ce=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],re=d("user-x",ce);function ue(){const{user:c}=R(),[n,l]=o.useState([]),[h,S]=o.useState(!0),[_,C]=o.useState(""),[x,y]=o.useState(null),[a,f]=o.useState(null),[p,g]=o.useState(null),[m,j]=o.useState(null);o.useEffect(()=>{q().then(l).finally(()=>S(!1))},[]);const T=async()=>{x&&(await K(x.id),l(t=>t.map(s=>s.id===x.id?{...s,notes_count:0,collections_count:0,labels_count:0,policies_count:0,disk_usage:0,notes_this_month:0,policies_this_month:0}:s)),y(null))},D=t=>t.id===c?.id,v=t=>!t.approved_at,i=t=>t.banned_until&&new Date(t.banned_until)>new Date,U=async()=>{a&&(i(a)?(await V(a.id),l(t=>t.map(s=>s.id===a.id?{...s,banned_until:null}:s))):(await X(a.id),l(t=>t.map(s=>s.id===a.id?{...s,banned_until:"2999-12-31T00:00:00Z"}:s))),f(null))},A=async()=>{p&&(await Y(p.id),l(t=>t.map(s=>s.id===p.id?{...s,approved_at:new Date().toISOString()}:s)),g(null))},z=async()=>{m&&(await Z(m.id),l(t=>t.filter(s=>s.id!==m.id)),j(null))},N=n.filter(t=>t.email.toLowerCase().includes(_.toLowerCase())),L=n.filter(t=>v(t)).length,M=n.reduce((t,s)=>t+s.notes_count,0),$=n.reduce((t,s)=>t+s.policies_count,0),H=n.reduce((t,s)=>t+s.collections_count,0),B=n.filter(t=>{if(!t.last_sign_in_at)return!1;const s=new Date(t.last_sign_in_at),P=new Date;return s.toDateString()===P.toDateString()}).length;return h?e.jsx("div",{className:"text-[#7a7890] text-[14px] text-center pt-40",children:"Loading..."}):e.jsxs("div",{className:"max-w-5xl mx-auto px-6 py-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[e.jsx(E,{size:22,className:"text-[#ec4899]"}),e.jsx("h1",{className:"text-[22px] font-bold text-white",children:"Admin"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-8",children:[e.jsx(r,{icon:b,label:"Total users",value:n.length}),e.jsx(r,{icon:F,label:"Pending users",value:L}),e.jsx(r,{icon:b,label:"Active today",value:B}),e.jsx(r,{icon:I,label:"Total notes",value:M}),e.jsx(r,{icon:O,label:"Total policies",value:$}),e.jsx(r,{icon:te,label:"Total collections",value:H}),e.jsx(r,{icon:ae,label:"Total disk",value:w(n.reduce((t,s)=>t+s.disk_usage,0))})]}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx(J,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-[#4a4660]"}),e.jsx("input",{type:"text",placeholder:"Search by email...",value:_,onChange:t=>C(t.target.value),className:"w-full bg-[#13111c] border border-[#1c1928] rounded-lg pl-10 pr-4 py-2.5 text-[13px] text-white placeholder-[#4a4660] outline-none focus:border-[#ec4899]/50 transition-colors"})]}),e.jsx("div",{className:"rounded-xl border border-[#1c1928] overflow-hidden",children:e.jsxs("table",{className:"w-full text-[13px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#13111c] text-[#7a7890] text-left",children:[e.jsx("th",{className:"px-4 py-3 font-medium",children:"Email"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Signed up"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Last active"}),e.jsx("th",{className:"px-4 py-3 font-medium text-right",children:"Notes"}),e.jsx("th",{className:"px-4 py-3 font-medium text-right",children:"Policies"}),e.jsx("th",{className:"px-4 py-3 font-medium text-right",children:"Collections"}),e.jsx("th",{className:"px-4 py-3 font-medium text-right",children:"Labels"}),e.jsx("th",{className:"px-4 py-3 font-medium text-right",children:"Disk"}),e.jsx("th",{className:"px-4 py-3 font-medium"})]})}),e.jsxs("tbody",{children:[N.map(t=>e.jsxs("tr",{className:"border-t border-[#1c1928] hover:bg-white/[0.02] transition-colors",children:[e.jsxs("td",{className:"px-4 py-3 text-white",children:[t.email,v(t)&&e.jsx("span",{className:"ml-2 text-[10px] font-medium bg-yellow-500/15 text-yellow-400 px-1.5 py-0.5 rounded",children:"Pending"}),i(t)&&e.jsx("span",{className:"ml-2 text-[10px] font-medium bg-red-500/15 text-red-400 px-1.5 py-0.5 rounded",children:"Suspended"})]}),e.jsx("td",{className:"px-4 py-3 text-[#7a7890]",children:k(t.created_at)}),e.jsx("td",{className:"px-4 py-3 text-[#7a7890]",children:t.last_sign_in_at?k(t.last_sign_in_at):"â€”"}),e.jsxs("td",{className:"px-4 py-3 text-[#7a7890] text-right",children:[t.notes_count,t.notes_this_month>0&&e.jsxs("span",{className:"ml-1.5 text-[11px] text-emerald-400",children:["+",t.notes_this_month]})]}),e.jsxs("td",{className:"px-4 py-3 text-[#7a7890] text-right",children:[t.policies_count,t.policies_this_month>0&&e.jsxs("span",{className:"ml-1.5 text-[11px] text-emerald-400",children:["+",t.policies_this_month]})]}),e.jsx("td",{className:"px-4 py-3 text-[#7a7890] text-right",children:t.collections_count}),e.jsx("td",{className:"px-4 py-3 text-[#7a7890] text-right",children:t.labels_count}),e.jsx("td",{className:"px-4 py-3 text-[#7a7890] text-right",children:w(t.disk_usage)}),e.jsx("td",{className:"px-4 py-3 text-right flex items-center justify-end gap-1",children:D(t)?e.jsx("span",{className:"text-[11px] text-[#4a4660]",children:"You"}):e.jsxs(e.Fragment,{children:[v(t)&&e.jsx("button",{onClick:()=>g(t),className:"text-[#7a7890] hover:text-emerald-400 transition-colors p-1 rounded",title:"Approve user",children:e.jsx(W,{size:14})}),e.jsx("button",{onClick:()=>f(t),className:`transition-colors p-1 rounded ${i(t)?"text-[#7a7890] hover:text-emerald-400":"text-[#7a7890] hover:text-[#f87171]"}`,title:i(t)?"Unsuspend user":"Suspend user",children:i(t)?e.jsx(le,{size:14}):e.jsx(re,{size:14})}),e.jsx("button",{onClick:()=>y(t),className:"text-[#7a7890] hover:text-[#f87171] transition-colors p-1 rounded",title:"Delete user data",children:e.jsx(G,{size:14})}),e.jsx("button",{onClick:()=>j(t),className:"text-[#7a7890] hover:text-[#f87171] transition-colors p-1 rounded",title:"Remove user",children:e.jsx(oe,{size:14})})]})})]},t.id)),N.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-4 py-8 text-center text-[#7a7890]",children:"No users found"})})]})]})}),e.jsx(u,{open:!!x,onClose:()=>y(null),onConfirm:T,title:"Delete user data",message:`This will permanently delete all notes, collections, labels, and policies for ${x?.email}. The user account itself will remain.`,confirmLabel:"Delete data"}),e.jsx(u,{open:!!a,onClose:()=>f(null),onConfirm:U,title:a&&i(a)?"Unsuspend user":"Suspend user",message:a&&i(a)?`Unsuspend user? ${a?.email} will be able to sign in again.`:`Suspend user? ${a?.email} will not be able to sign in.`,confirmLabel:a&&i(a)?"Unsuspend":"Suspend"}),e.jsx(u,{open:!!p,onClose:()=>g(null),onConfirm:A,title:"Approve user",message:`Approve ${p?.email}? They will receive an email and gain access to Petek.`,confirmLabel:"Approve",variant:"success"}),e.jsx(u,{open:!!m,onClose:()=>j(null),onConfirm:z,title:"Remove user",message:`This will permanently delete all data AND the account for ${m?.email}. This cannot be undone.`,confirmLabel:"Remove user"})]})}function w(c){if(c===0)return"0 B";const n=1024,l=["B","KB","MB","GB"],h=Math.floor(Math.log(c)/Math.log(n));return parseFloat((c/Math.pow(n,h)).toFixed(1))+" "+l[h]}function r({icon:c,label:n,value:l}){return e.jsxs("div",{className:"bg-[#13111c] border border-[#1c1928] rounded-xl px-5 py-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[#7a7890] mb-1",children:[e.jsx(c,{size:14}),e.jsx("span",{className:"text-[12px]",children:n})]}),e.jsx("span",{className:"text-[22px] font-bold text-white",children:l})]})}export{ue as default};
