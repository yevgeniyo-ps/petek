import{j as e}from"./md-editor-C1q9TcpX.js";import{r as i}from"./react-vendor-tRUzE08Q.js";import{c as P,y as Y,n as J,C as A,X as K,p as E,f as Q,T as W,M as Z}from"./index-BFU_njf7.js";import{r as ee,u as R}from"./xlsx-DFH0qU2H.js";import{C as T}from"./chevron-down-B4Rhi2K0.js";import{E as te}from"./external-link-cKziVxm1.js";import{S as se,C as ne}from"./ConfirmDialog-CjtMJDw2.js";import"./supabase-BZ0N5lZN.js";const re=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],O=P("circle-alert",re);const ae=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],oe=P("columns-3",ae);const ie=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7.5 3v18",key:"w0wo6v"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M16.5 3v18",key:"10tjh1"}]],le=P("columns-4",ie);const ce=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],de=P("copy",ce);const ue=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]],me=P("file-spreadsheet",ue);const xe=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],pe=P("rotate-ccw",xe);const he=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],fe=P("triangle-alert",he);const be=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],q=P("upload",be),ye={he:{category:"תחום",main_branch:"ענף ראשי",sub_branch:"ענף (משני)",product_type:"סוג מוצר",company:"חברה",coverage_period:"תקופת ביטוח",additional_details:"פרטים נוספים",premium_nis:'פרמיה בש"ח',premium_type:"סוג פרמיה",policy_number:"מספר פוליסה",plan_classification:"סיווג תכנית"},en:{category:"Category",main_branch:"Main Branch",sub_branch:"Sub Branch",product_type:"Product Type",company:"Company",coverage_period:"Coverage Period",additional_details:"Additional Details",premium_nis:"Premium (NIS)",premium_type:"Premium Type",policy_number:"Policy Number",plan_classification:"Plan Classification"}},ge=["company","sub_branch","category","coverage_period","premium_nis","policy_number"],ve=["company","sub_branch","main_branch","category","product_type","coverage_period","premium_nis","premium_type","policy_number","plan_classification","additional_details"],je={כללי:"General","בריאות ותאונות אישיות":"Health & Personal Accidents",בריאות:"Health","חיים ואבדן כושר עבודה":"Life & Disability",חיים:"Life",פנסיה:"Pension",רכב:"Vehicle",דירה:"Home/Property",משכנתא:"Mortgage",'נסיעות לחו"ל':"Travel","אחריות מקצועית":"Professional Liability",אלמנטרי:"Elementary"},we={שנתית:"Annual",חודשית:"Monthly",רבעונית:"Quarterly","חד פעמית":"One-time",אישי:"Personal",משפחתי:"Family",קבוצתי:"Group","פוליסת ביטוח":"Insurance Policy","הסכם שירות":"Service Agreement","ביטוח רכב":"Vehicle Insurance","רכב חובה":"Mandatory Vehicle","ביטוח מקיף":"Comprehensive","ביטוח צד ג":"Third Party","ביטוח דירה":"Home Insurance",מבנה:"Structure",תכולה:"Contents","ביטוח בריאות":"Health Insurance","ביטוח חיים":"Life Insurance","אובדן כושר עבודה":"Loss of Work Capacity","ייעוץ ובדיקות":"Consultations & Tests","ניתוחים וטיפולים":"Surgeries & Treatments",תרופות:"Medications",שיניים:"Dental",מתחדש:"Renewable",'איי. די. איי. חברה לביטוח בע"מ':"IDI Insurance",'מנורה מבטחים ביטוח בע"מ':"Menora Mivtachim Insurance",'הראל חברה לביטוח בע"מ':"Harel Insurance",'מגדל חברה לביטוח בע"מ':"Migdal Insurance",'כלל חברה לביטוח בע"מ':"Clal Insurance",'הפניקס חברה לביטוח בע"מ':"Phoenix Insurance",'איילון חברה לביטוח בע"מ':"Ayalon Insurance","ביטוח ישיר":"Bituach Yashir (Direct Insurance)",'שירביט חברה לביטוח בע"מ':"Shirbit Insurance"};function D(t,a){return a==="he"||!t?t:we[t]??t}function G(t,a){return a==="he"||!t?t:je[t]??t}const Ne={חודשית:"/mo",שנתית:"/yr",רבעונית:"/qtr"};function _e(t,a){if(t==null)return"—";const p=t.toLocaleString("en-IL",{minimumFractionDigits:2,maximumFractionDigits:2}),d=Ne[a]??"";return`₪${p}${d}`}function Ce(t,a,p){const d=t[a];return d==null||d===""?"—":a==="premium_nis"?_e(d,t.premium_type):a==="category"?G(String(d),p):D(String(d),p)}const ke={orange:"bg-orange-500/[0.08]",yellow:"bg-yellow-500/[0.08]",blue:"bg-blue-500/[0.08]"},Se={orange:"border-l-2 border-l-orange-500",yellow:"border-l-2 border-l-yellow-500",blue:"border-l-2 border-l-blue-500"};function $e({policies:t,lang:a,highlightedPolicies:p,highlightSeverity:d}){const[l,b]=i.useState(!1),[f,y]=i.useState(null),h=l?ve:ge,C=ye[a],v=a==="he";i.useEffect(()=>{p&&p.size>0&&y(null)},[p]);const g=p&&p.size>0,j=g?p:f?new Set([f]):null;return e.jsxs("div",{className:"rounded-xl border border-[#1c1928] overflow-hidden",children:[e.jsx("div",{className:"flex items-center justify-end px-4 py-2 bg-[#0f0d18] border-b border-[#1c1928]",children:e.jsxs("button",{onClick:()=>b(!l),className:"flex items-center gap-1.5 text-[12px] text-[#7a7890] hover:text-white transition-colors",children:[l?e.jsx(oe,{size:14}):e.jsx(le,{size:14}),l?v?"תצוגה מצומצמת":"Compact view":v?"כל העמודות":"All columns"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[#1c1928]",children:h.map(c=>e.jsx("th",{className:`px-4 py-3 text-left text-[12px] font-medium text-[#7a7890] uppercase tracking-wider whitespace-nowrap bg-[#0f0d18] ${c==="premium_nis"?"text-right":""}`,children:C[c]},c))})}),e.jsx("tbody",{children:t.map(c=>{const S=p?.has(c.policy_number)&&d,_=!g&&f===c.policy_number,n=j&&!j.has(c.policy_number);return e.jsx("tr",{onClick:()=>{g||y(f===c.policy_number?null:c.policy_number)},className:`border-b border-[#1c1928] last:border-b-0 transition-colors cursor-pointer ${S?`${ke[d]} ${Se[d]}`:_?"bg-[#ec4899]/[0.08] border-l-2 border-l-[#ec4899]":n?"opacity-40":"hover:bg-white/[0.02]"}`,children:h.map(o=>e.jsx("td",{className:`px-4 py-3 text-[13px] ${o==="premium_nis"?"text-right text-white font-medium tabular-nums whitespace-nowrap":o==="additional_details"?"text-[#e0dfe4] max-w-[200px] truncate":"text-[#e0dfe4] whitespace-nowrap"}`,children:Ce(c,o,a)},o))},c.id)})})]})}),t.length===0&&e.jsx("div",{className:"py-16 text-center",children:e.jsx("p",{className:"text-[14px] text-[#7a7890]",children:"No policies match your search."})})]})}function Me(t,a){const p=ee(t,{type:"array"}),d=p.SheetNames[0];if(!d)return{policies:[],errors:["Empty workbook."]};const l=p.Sheets[d];if(!l)return{policies:[],errors:["Empty workbook."]};const b=Object.keys(l).filter(g=>g[0]!=="!");if(b.length>0){let g=0,j=0,c=1/0,S=1/0;for(const _ of b){const n=R.decode_cell(_);n.r>g&&(g=n.r),n.c>j&&(j=n.c),n.r<c&&(c=n.r),n.c<S&&(S=n.c)}l["!ref"]=R.encode_range({s:{r:c,c:S},e:{r:g,c:j}})}const f=R.sheet_to_json(l,{header:1,defval:"",raw:!1}),y=[],h=[];let C="",v=!1;for(let g=0;g<f.length;g++){const j=f[g];if(!j||j.every(s=>!s||String(s).trim()===""))continue;const c=String(j[0]??"").trim();if(c==="תעודת זהות"){v=!0;continue}const _=j.map(s=>String(s??"").trim()).filter(Boolean).join(" ").trim().match(/תחום\s*[-–—]\s*(.+)/);if(_&&_[1]){C=_[1].trim();continue}if(!v||c.includes('סה"כ')||c.includes("סהכ")||!/^\d+$/.test(c.replace(/\s/g,"")))continue;const n=j.map(s=>String(s??"").trim());let o=null;const $=n[7]??"";if($){const s=$.replace(/[₪,\s]/g,""),u=parseFloat(s);isNaN(u)||(o=u)}h.push({upload_batch_id:a,category:C,identity_number:n[0]??"",main_branch:n[1]??"",sub_branch:n[2]??"",product_type:n[3]??"",company:n[4]??"",coverage_period:n[5]??"",additional_details:n[6]??"",premium_nis:o,premium_type:n[8]??"",policy_number:n[9]??"",plan_classification:n[10]??""})}return h.length===0&&y.push("No insurance data found. Make sure you uploaded the correct file from Har HaBituach."),{policies:h,errors:y}}function U({onDone:t}){const{replacePolicies:a,uploading:p}=Y(),[d,l]=i.useState(!1),[b,f]=i.useState(null),[y,h]=i.useState([]),C=i.useRef(null),v=i.useCallback(async n=>{h([]),f(null);const o=n.name.split(".").pop()?.toLowerCase();if(o!=="xlsx"&&o!=="csv"&&o!=="xls"){h(["Unsupported file type. Please upload an .xlsx or .csv file."]);return}try{const $=await n.arrayBuffer(),s=crypto.randomUUID(),u=Me($,s);if(u.errors.length>0){h(u.errors);return}f(u.policies)}catch{h(["Failed to parse file. Make sure it is a valid Excel or CSV file."])}},[]),g=i.useCallback(n=>{n.preventDefault(),l(!1);const o=n.dataTransfer.files[0];o&&v(o)},[v]),j=i.useCallback(n=>{const o=n.target.files?.[0];o&&v(o),n.target.value=""},[v]),c=async()=>{if(b)try{await a(b),f(null),t?.()}catch{h(["Failed to save data. Please try again."])}},S=()=>{f(null),h([])},_=b?Object.entries(b.reduce((n,o)=>{const $=o.category||"Uncategorized";return n[$]=(n[$]??0)+1,n},{})):[];return b?e.jsxs("div",{className:"rounded-xl border border-[#1c1928] bg-[#13111c] p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(me,{size:24,className:"text-[#ec4899]"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[15px] font-semibold text-white",children:[b.length," ",b.length===1?"policy":"policies"," found"]}),e.jsx("p",{className:"text-[13px] text-[#7a7890] mt-0.5",children:_.map(([n,o])=>`${n} (${o})`).join(", ")})]})]}),y.length>0&&e.jsx("div",{className:"mb-4 p-3 rounded-lg bg-red-500/10 border border-red-500/20",children:y.map((n,o)=>e.jsxs("p",{className:"text-[13px] text-red-400 flex items-center gap-2",children:[e.jsx(O,{size:14})," ",n]},o))}),e.jsxs("div",{className:"flex justify-end gap-2.5 mt-6",children:[e.jsx("button",{onClick:S,className:"px-4 py-2 text-[13px] text-[#7a7890] hover:text-white rounded-lg hover:bg-white/[0.04] transition-all",children:"Cancel"}),e.jsx("button",{onClick:c,disabled:p,className:"px-5 py-2 text-[13px] bg-[#ec4899] hover:bg-[#db2777] text-white font-medium rounded-full transition-colors disabled:opacity-50",children:p?"Uploading...":"Upload & Replace"})]})]}):e.jsxs("div",{children:[e.jsxs("div",{onDragOver:n=>{n.preventDefault(),l(!0)},onDragLeave:()=>l(!1),onDrop:g,onClick:()=>C.current?.click(),className:`rounded-xl border-2 border-dashed py-16 text-center cursor-pointer transition-all ${d?"border-[#ec4899] bg-[#ec4899]/5":"border-[#1c1928] bg-[#0f0d18] hover:border-[#2d2a40] hover:bg-[#13111c]"}`,children:[e.jsx(q,{size:32,className:`mx-auto mb-4 ${d?"text-[#ec4899]":"text-[#7a7890]"}`}),e.jsx("p",{className:"text-[14px] text-white font-medium mb-1",children:"Drag & drop your insurance file"}),e.jsx("p",{className:"text-[13px] text-[#7a7890]",children:"or click to browse — accepts .xlsx, .csv"}),e.jsx("input",{ref:C,type:"file",accept:".xlsx,.xls,.csv",onChange:j,className:"hidden"})]}),y.length>0&&e.jsx("div",{className:"mt-4 p-3 rounded-lg bg-red-500/10 border border-red-500/20",children:y.map((n,o)=>e.jsxs("p",{className:"text-[13px] text-red-400 flex items-center gap-2",children:[e.jsx(O,{size:14})," ",n]},o))})]})}function Ie(t,a){return t==null?0:a==="חודשית"?t*12:a==="שנתית"?t:a==="רבעונית"?t*4:t}function Le({policies:t,lang:a}){const[p,d]=i.useState("monthly"),l=i.useMemo(()=>{let y=0;const h=new Set;for(const C of t)h.add(C.company),y+=Ie(C.premium_nis,C.premium_type);return{totalPolicies:t.length,annualTotal:y,monthlyTotal:y/12,companiesCount:h.size}},[t]),b=a==="he",f=p==="monthly"?l.monthlyTotal:l.annualTotal;return e.jsx("div",{className:"mt-8 mb-6",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-[#13111c] border border-[#1c1928] rounded-xl px-5 py-4",children:[e.jsx("div",{className:"text-[22px] font-bold text-white tabular-nums",children:l.totalPolicies}),e.jsx("div",{className:"text-[12px] text-[#7a7890] mt-0.5",children:b?"פוליסות":"Policies"})]}),e.jsxs("div",{className:"bg-[#13111c] border border-[#1c1928] rounded-xl px-5 py-4",children:[e.jsxs("div",{className:"text-[22px] font-bold text-white tabular-nums",children:["₪",Math.round(f).toLocaleString("en-IL")]}),e.jsx("div",{className:"flex items-center gap-2 mt-0.5",children:e.jsxs("div",{className:"flex rounded border border-[#1c1928] overflow-hidden",children:[e.jsx("button",{onClick:()=>d("monthly"),className:`px-2 py-0.5 text-[11px] font-medium transition-colors ${p==="monthly"?"bg-[#1a1730] text-white":"text-[#4a4660] hover:text-[#7a7890]"}`,children:b?"חודשי":"Monthly"}),e.jsx("button",{onClick:()=>d("yearly"),className:`px-2 py-0.5 text-[11px] font-medium transition-colors ${p==="yearly"?"bg-[#1a1730] text-white":"text-[#4a4660] hover:text-[#7a7890]"}`,children:b?"שנתי":"Yearly"})]})})]}),e.jsxs("div",{className:"bg-[#13111c] border border-[#1c1928] rounded-xl px-5 py-4",children:[e.jsx("div",{className:"text-[22px] font-bold text-white tabular-nums",children:l.companiesCount}),e.jsx("div",{className:"text-[12px] text-[#7a7890] mt-0.5",children:b?"חברות":"Companies"})]})]})})}const V="petek:dismissed-recs";function De(){try{const t=localStorage.getItem(V);return t?new Set(JSON.parse(t)):new Set}catch{return new Set}}function H(t){localStorage.setItem(V,JSON.stringify([...t]))}function F(t,a){return t==null?0:a==="חודשית"?t*12:a==="שנתית"?t:a==="רבעונית"?t*4:t}function Pe(t){const a=t.split(" - ");if(a.length<2)return null;const d=a[1].trim().match(/^(\d{2})\/(\d{2})\/(\d{4})$/);return d?new Date(+d[3],+d[2]-1,+d[1]):null}const ze={orange:"border-l-orange-500",yellow:"border-l-yellow-500",blue:"border-l-blue-500"};function Re({policies:t,lang:a,activeRecIndex:p,onSelect:d}){const[l,b]=i.useState(!1),[f,y]=i.useState(De),[h,C]=i.useState(!1),v=i.useCallback(s=>{y(u=>{const w=new Set(u);return w.add(s),H(w),w}),d(null,[],"blue")},[d]),g=i.useCallback(s=>{y(u=>{const w=new Set(u);return w.delete(s),H(w),w})},[]),j=i.useCallback(()=>{y(new Set),H(new Set)},[]),c=i.useMemo(()=>{const s=[],u=a==="he",w=new Date,I=720*60*60*1e3;for(const m of t){const k=Pe(m.coverage_period);if(!k)continue;const r=k.getTime()-w.getTime();if(r>0&&r<=I){const x=Math.ceil(r/864e5),N=u?m.sub_branch:D(m.sub_branch,"en");s.push({key:`expiring:${m.policy_number}`,severity:"orange",title:u?`${N} פג תוקף בעוד ${x} ימים`:`${N} expires in ${x} days`,description:u?`פוליסה ${m.policy_number} ב-${m.company} מסתיימת בקרוב. שקול לחדש.`:`Policy ${m.policy_number} at ${D(m.company,"en")} expires soon. Consider renewing.`,icon:e.jsx(J,{size:16}),policies:[{number:m.policy_number,company:u?m.company:D(m.company,"en")}],savingsPerYear:0})}}const L=new Map;for(const m of t){const k=L.get(m.sub_branch)??[];k.push(m),L.set(m.sub_branch,k)}for(const[,m]of L){const k=new Map;for(const M of m)k.has(M.policy_number)||k.set(M.policy_number,M);const r=Array.from(k.values());if(r.length<2)continue;const x=r[0],N=u?x.sub_branch:D(x.sub_branch,"en"),X=r.map(M=>F(M.premium_nis,M.premium_type)).sort((M,z)=>M-z).slice(1).reduce((M,z)=>M+z,0);s.push({key:`dup:${x.sub_branch}`,severity:"yellow",title:u?`כפילות אפשרית: ${N} (${r.length} פוליסות)`:`Possible duplicate: ${N} (${r.length} policies)`,description:u?`נמצאו ${r.length} פוליסות שונות עם אותו סוג כיסוי. בדוק אם מדובר בכיסוי כפול.`:`Found ${r.length} distinct policies with the same coverage type. Check if this is redundant.`,icon:e.jsx(de,{size:16}),policies:r.map(M=>({number:M.policy_number,company:u?M.company:D(M.company,"en")})),savingsPerYear:X})}for(const m of t){const k=F(m.premium_nis,m.premium_type);if(k>2e3){const r=u?m.sub_branch:D(m.sub_branch,"en");s.push({key:`premium:${m.policy_number}`,severity:"blue",title:u?`פרמיה גבוהה: ${r} — ₪${Math.round(k).toLocaleString("en-IL")}/שנה`:`High premium: ${r} — ₪${Math.round(k).toLocaleString("en-IL")}/yr`,description:u?"שקול להשוות הצעות מחיר מחברות ביטוח אחרות.":"Consider comparing quotes from other insurers.",icon:e.jsx(fe,{size:16}),policies:[{number:m.policy_number,company:u?m.company:D(m.company,"en")}],savingsPerYear:Math.round(k*.2)})}}return s},[t,a]),S=i.useMemo(()=>c.filter(s=>!f.has(s.key)),[c,f]),_=i.useMemo(()=>c.filter(s=>f.has(s.key)),[c,f]),n=i.useMemo(()=>S.reduce((s,u)=>s+u.savingsPerYear,0),[S]);if(c.length===0)return null;const o=a==="he",$=s=>`₪${Math.round(s).toLocaleString("en-IL")}`;return e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>b(!l),className:"flex items-center gap-2 w-full text-left mb-3 group",children:[e.jsxs("span",{className:"text-[13px] text-[#7a7890] font-medium",children:[o?"המלצות":"Recommendations"," (",S.length,")"]}),n>0&&e.jsx("span",{className:"text-[12px] text-emerald-400 font-medium",children:o?`חיסכון פוטנציאלי: ~${$(n)}/שנה`:`Potential savings: ~${$(n)}/yr`}),l?e.jsx(T,{size:14,className:"text-[#7a7890]"}):e.jsx(A,{size:14,className:"text-[#7a7890]"})]}),!l&&e.jsxs("div",{className:"space-y-2",children:[S.map((s,u)=>{const w=p===u;return e.jsxs("div",{className:"relative group/rec",children:[e.jsxs("button",{onClick:()=>{const I=s.policies.map(L=>L.number);d(w?null:u,I,s.severity)},className:`flex items-start gap-3 w-full text-left border border-l-[3px] ${ze[s.severity]} rounded-lg px-4 py-3 pr-9 transition-colors cursor-pointer ${w?"bg-[#1a1730] border-[#2d2a40]":"bg-[#13111c] border-[#1c1928] hover:bg-[#16141f]"}`,children:[e.jsx("div",{className:`mt-0.5 shrink-0 ${s.severity==="orange"?"text-orange-500":s.severity==="yellow"?"text-yellow-500":"text-blue-500"}`,children:s.icon}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-[13px] text-white font-medium flex items-center gap-2 flex-wrap",children:[s.title,s.savingsPerYear>0&&e.jsx("span",{className:"text-[11px] text-emerald-400 font-normal",children:o?`~${$(s.savingsPerYear)}/שנה`:`~${$(s.savingsPerYear)}/yr`})]}),e.jsx("div",{className:"text-[12px] text-[#7a7890] mt-0.5",children:s.description}),e.jsxs("div",{className:"text-[11px] mt-1 flex items-center gap-2 flex-wrap",children:[s.policies.map((I,L)=>e.jsxs("span",{className:w?"text-[#7a7890]":"text-[#4a4660]",children:[o?"פוליסה":"Policy"," ",I.number," · ",I.company]},L)),e.jsx("span",{className:`text-[11px] ${w?"text-[#7a7890]":"text-[#4a4660]"}`,children:w?o?"— לחץ לביטול":"— click to clear":o?"— לחץ להדגשה בטבלה":"— click to highlight"})]})]})]}),e.jsx("button",{onClick:I=>{I.stopPropagation(),v(s.key)},className:"absolute top-3 right-3 p-0.5 rounded text-[#4a4660] opacity-0 group-hover/rec:opacity-100 hover:text-white hover:bg-white/[0.08] transition-all",title:o?"השתק":"Dismiss",children:e.jsx(K,{size:14})})]},s.key)}),_.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{onClick:()=>C(!h),className:"flex items-center gap-1.5 text-[11px] text-[#4a4660] hover:text-[#7a7890] transition-colors",children:[h?e.jsx(A,{size:12}):e.jsx(T,{size:12}),o?`${_.length} המלצות מושתקות`:`${_.length} dismissed`,h&&e.jsxs("span",{onClick:s=>{s.stopPropagation(),j()},className:"text-[#4a4660] hover:text-[#7a7890] ml-1",children:["(",o?"שחזר הכל":"restore all",")"]})]}),h&&e.jsx("div",{className:"space-y-1.5 mt-2",children:_.map(s=>e.jsxs("div",{className:"flex items-center gap-3 bg-white/[0.02] border border-[#1c1928] rounded-lg px-4 py-2 opacity-50",children:[e.jsx("div",{className:`shrink-0 ${s.severity==="orange"?"text-orange-500":s.severity==="yellow"?"text-yellow-500":"text-blue-500"}`,children:s.icon}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsx("div",{className:"text-[12px] text-[#7a7890] truncate",children:s.title})}),e.jsx("button",{onClick:()=>g(s.key),className:"shrink-0 p-1 rounded text-[#4a4660] hover:text-white hover:bg-white/[0.08] transition-all",title:o?"שחזר":"Restore",children:e.jsx(pe,{size:12})})]},s.key))})]})]})]})}const He={he:{line1:"היכנסו ל",harb:"הר הביטוח",line2:', לחצו "כל הביטוחים" ואז על כפתור הייצוא לאקסל.',line3:"גררו את הקובץ שהורד לכאן."},en:{line1:"Go to ",harb:"Har HaBituach",line2:', click "כל הביטוחים" then the Export to Excel button.',line3:"Drag the downloaded file here."}};function B({lang:t}){const a=He[t];return e.jsxs("p",{className:"mt-4 text-[13px] text-[#7a7890]",dir:t==="he"?"rtl":"ltr",children:[a.line1,e.jsxs("a",{href:"https://harb.cma.gov.il",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-[#ec4899] hover:text-[#db2777] transition-colors",children:[a.harb,e.jsx(te,{size:11})]}),a.line2,e.jsx("br",{}),a.line3]})}function Ge(){const{policies:t,loading:a,lastUploadDate:p,clearAll:d}=Y(),[l,b]=i.useState("he"),[f,y]=i.useState(""),[h,C]=i.useState(null),[v,g]=i.useState(null),[j,c]=i.useState(!1),[S,_]=i.useState(!1),[n,o]=i.useState(null),[$,s]=i.useState(new Set),[u,w]=i.useState(null),I=i.useCallback((r,x,N)=>{r===null?(o(null),s(new Set),w(null)):(o(r),s(new Set(x)),w(N))},[]),L=i.useMemo(()=>{const r=new Set;for(const x of t)x.category&&r.add(x.category);return Array.from(r)},[t]),m=i.useMemo(()=>{const r=new Set;for(const x of t)x.company&&r.add(x.company);return Array.from(r)},[t]),k=i.useMemo(()=>{let r=t;if(h&&(r=r.filter(x=>x.category===h)),v&&(r=r.filter(x=>x.company===v)),f){const x=f.toLowerCase();r=r.filter(N=>N.main_branch.toLowerCase().includes(x)||N.sub_branch.toLowerCase().includes(x)||N.product_type.toLowerCase().includes(x)||N.company.toLowerCase().includes(x)||N.coverage_period.toLowerCase().includes(x)||N.additional_details.toLowerCase().includes(x)||N.premium_type.toLowerCase().includes(x)||N.policy_number.toLowerCase().includes(x)||N.plan_classification.toLowerCase().includes(x)||N.category.toLowerCase().includes(x))}return r},[t,f,h,v]);return a?e.jsx("div",{className:"text-[#7a7890] text-[14px] text-center pt-40",children:"Loading..."}):t.length===0?e.jsxs("div",{className:"max-w-[1200px] px-12 py-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx(E,{size:24,className:"text-[#ec4899]"}),e.jsx("h1",{className:"text-[26px] font-bold text-white leading-tight",children:"Insurances"})]}),e.jsx("p",{className:"text-[14px] text-[#7a7890] mt-2 mb-8",children:"Upload your insurance file from Har HaBituach to get started."}),e.jsx(U,{}),e.jsx(B,{lang:"en"})]}):e.jsxs("div",{className:"max-w-[1200px] px-12 py-10",children:[e.jsxs("div",{className:"mb-1 flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{size:24,className:"text-[#ec4899]"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-[26px] font-bold text-white leading-tight",children:"Insurances"}),e.jsxs("p",{className:"text-[14px] text-[#7a7890] mt-1",children:[t.length," ",t.length===1?"policy":"policies",p&&e.jsxs(e.Fragment,{children:[" · Updated ",Q(p)]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex rounded-lg border border-[#1c1928] overflow-hidden",children:[e.jsx("button",{onClick:()=>b("he"),className:`px-3 py-1.5 text-[12px] font-medium transition-colors ${l==="he"?"bg-[#1a1730] text-white":"text-[#7a7890] hover:text-white hover:bg-white/[0.04]"}`,children:"עב"}),e.jsx("button",{onClick:()=>b("en"),className:`px-3 py-1.5 text-[12px] font-medium transition-colors ${l==="en"?"bg-[#1a1730] text-white":"text-[#7a7890] hover:text-white hover:bg-white/[0.04]"}`,children:"EN"})]}),e.jsxs("button",{onClick:()=>c(!0),className:"flex items-center gap-2 px-4 py-2 text-[13px] text-[#7a7890] hover:text-white border border-[#1c1928] hover:border-[#2d2a40] rounded-lg transition-all",children:[e.jsx(q,{size:14}),"Re-upload"]}),e.jsx("button",{onClick:()=>_(!0),className:"flex items-center gap-2 px-4 py-2 text-[13px] text-[#7a7890] hover:text-red-400 border border-[#1c1928] hover:border-red-500/30 rounded-lg transition-all",children:e.jsx(W,{size:14})})]})]}),e.jsx(Le,{policies:t,lang:l}),e.jsx(Re,{policies:t,lang:l,activeRecIndex:n,onSelect:I}),e.jsx("div",{className:"flex items-center gap-4 mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(se,{size:14,className:"absolute left-4 top-1/2 -translate-y-1/2 text-[#7a7890]"}),e.jsx("input",{type:"text",placeholder:"Search policies...",value:f,onChange:r=>y(r.target.value),className:"pl-10 pr-5 py-2 bg-transparent border border-[#1c1928] rounded-full text-[13px] text-[#e0dfe4] placeholder-[#4a4660] outline-none focus:border-[#2d2a40] transition-colors w-72"})]})}),e.jsxs("div",{className:"flex items-center gap-6 mb-6 flex-wrap",children:[L.length>1&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("button",{onClick:()=>C(null),className:`px-3 py-1.5 rounded-full text-[12px] font-medium transition-colors ${h?"bg-white/[0.04] text-[#7a7890] hover:text-white hover:bg-white/[0.08]":"bg-[#ec4899] text-white"}`,children:l==="he"?"הכל":"All"}),L.map(r=>e.jsx("button",{onClick:()=>C(h===r?null:r),className:`px-3 py-1.5 rounded-full text-[12px] font-medium transition-colors ${h===r?"bg-[#ec4899] text-white":"bg-white/[0.04] text-[#7a7890] hover:text-white hover:bg-white/[0.08]"}`,children:G(r,l)},r))]}),m.length>1&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-[11px] text-[#4a4660] uppercase tracking-wider",children:l==="he"?"חברה":"Company"}),m.map(r=>e.jsx("button",{onClick:()=>g(v===r?null:r),className:`px-3 py-1.5 rounded-full text-[12px] font-medium transition-colors ${v===r?"bg-[#ec4899] text-white":"bg-white/[0.04] text-[#7a7890] hover:text-white hover:bg-white/[0.08]"}`,children:D(r,l)},r))]})]}),e.jsx($e,{policies:k,lang:l,highlightedPolicies:$,highlightSeverity:u}),e.jsx(ne,{open:S,onClose:()=>_(!1),onConfirm:d,title:"Delete all insurance data?",message:"This will permanently remove all your insurance policies. You can re-upload anytime.",confirmLabel:"Delete all"}),e.jsx(Z,{open:j,onClose:()=>c(!1),children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-[15px] font-semibold text-white mb-2",children:"Re-upload Insurance Data"}),e.jsx("p",{className:"text-[13px] text-[#7a7890] mb-6",children:"This will replace all existing insurance data with the new file."}),e.jsx(U,{onDone:()=>c(!1)}),e.jsx(B,{lang:l})]})})]})}export{Ge as default};
